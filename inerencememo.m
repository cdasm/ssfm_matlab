%memo for inference


x=sym('x',[1,3]);
y=sym('y',[1,3]);

a=sym('a',[3,3]);

mul=(dot(x,a*y'))^2

v=reshape(a,[1,9])

re1=sym('r',[1,81])

re2=sym('rr',[1,81])

for i=1:9
    for j=1:9
        ind=(i-1)*9+j
        re1(1,ind)=v(i)*v(j);
        tm=diff(diff(mul,v(i)),v(j));

        tm=tm/2;

        re2(1,ind)=tm;
    end
end
    
re1 = [ a1_1^2, a1_1*a2_1, a1_1*a3_1, a1_1*a1_2, a1_1*a2_2, a1_1*a3_2, a1_1*a1_3, a1_1*a2_3, a1_1*a3_3, a1_1*a2_1, a2_1^2, a2_1*a3_1, a1_2*a2_1, a2_1*a2_2, a2_1*a3_2, a1_3*a2_1, a2_1*a2_3, a2_1*a3_3, a1_1*a3_1, a2_1*a3_1, a3_1^2, a1_2*a3_1, a2_2*a3_1, a3_1*a3_2, a1_3*a3_1, a2_3*a3_1, a3_1*a3_3, a1_1*a1_2, a1_2*a2_1, a1_2*a3_1, a1_2^2, a1_2*a2_2, a1_2*a3_2, a1_2*a1_3, a1_2*a2_3, a1_2*a3_3, a1_1*a2_2, a2_1*a2_2, a2_2*a3_1, a1_2*a2_2, a2_2^2, a2_2*a3_2, a1_3*a2_2, a2_2*a2_3, a2_2*a3_3, a1_1*a3_2, a2_1*a3_2, a3_1*a3_2, a1_2*a3_2, a2_2*a3_2, a3_2^2, a1_3*a3_2, a2_3*a3_2, a3_2*a3_3, a1_1*a1_3, a1_3*a2_1, a1_3*a3_1, a1_2*a1_3, a1_3*a2_2, a1_3*a3_2, a1_3^2, a1_3*a2_3, a1_3*a3_3, a1_1*a2_3, a2_1*a2_3, a2_3*a3_1, a1_2*a2_3, a2_2*a2_3, a2_3*a3_2, a1_3*a2_3, a2_3^2, a2_3*a3_3, a1_1*a3_3, a2_1*a3_3, a3_1*a3_3, a1_2*a3_3, a2_2*a3_3, a3_2*a3_3, a1_3*a3_3, a2_3*a3_3, a3_3^2]

re2=[ x1^2*y1^2, x1*x2*y1^2, x1*x3*y1^2, x1^2*y1*y2, x1*x2*y1*y2, x1*x3*y1*y2, x1^2*y1*y3, x1*x2*y1*y3, x1*x3*y1*y3, x1*x2*y1^2, x2^2*y1^2, x2*x3*y1^2, x1*x2*y1*y2, x2^2*y1*y2, x2*x3*y1*y2, x1*x2*y1*y3, x2^2*y1*y3, x2*x3*y1*y3, x1*x3*y1^2, x2*x3*y1^2, x3^2*y1^2, x1*x3*y1*y2, x2*x3*y1*y2, x3^2*y1*y2, x1*x3*y1*y3, x2*x3*y1*y3, x3^2*y1*y3, x1^2*y1*y2, x1*x2*y1*y2, x1*x3*y1*y2, x1^2*y2^2, x1*x2*y2^2, x1*x3*y2^2, x1^2*y2*y3, x1*x2*y2*y3, x1*x3*y2*y3, x1*x2*y1*y2, x2^2*y1*y2, x2*x3*y1*y2, x1*x2*y2^2, x2^2*y2^2, x2*x3*y2^2, x1*x2*y2*y3, x2^2*y2*y3, x2*x3*y2*y3, x1*x3*y1*y2, x2*x3*y1*y2, x3^2*y1*y2, x1*x3*y2^2, x2*x3*y2^2, x3^2*y2^2, x1*x3*y2*y3, x2*x3*y2*y3, x3^2*y2*y3, x1^2*y1*y3, x1*x2*y1*y3, x1*x3*y1*y3, x1^2*y2*y3, x1*x2*y2*y3, x1*x3*y2*y3, x1^2*y3^2, x1*x2*y3^2, x1*x3*y3^2, x1*x2*y1*y3, x2^2*y1*y3, x2*x3*y1*y3, x1*x2*y2*y3, x2^2*y2*y3, x2*x3*y2*y3, x1*x2*y3^2, x2^2*y3^2, x2*x3*y3^2, x1*x3*y1*y3, x2*x3*y1*y3, x3^2*y1*y3, x1*x3*y2*y3, x2*x3*y2*y3, x3^2*y2*y3, x1*x3*y3^2, x2*x3*y3^2, x3^2*y3^2]
 
  
f(t)=sum(cross(p+t*u-q,v).^2)
d(t)=diff(f,t)

an=solve(d==0,'t')

f(an)=((v1^2 + v2^2 + v3^2)*(p1*u2*v3 - p1*u3*v2 - p2*u1*v3 + p2*u3*v1 + p3*u1*v2 - p3*u2*v1 - q1*u2*v3 + q1*u3*v2 + q2*u1*v3 - q2*u3*v1 - q3*u1*v2 + q3*u2*v1)^2)/(u1^2*v2^2 + u1^2*v3^2 - 2*u1*u2*v1*v2 - 2*u1*u3*v1*v3 + u2^2*v1^2 + u2^2*v3^2 - 2*u2*u3*v2*v3 + u3^2*v1^2 + u3^2*v2^2)
 


